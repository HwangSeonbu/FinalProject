<%--
 학생이 장학금 신청을 할수 있는 페이지
* [[개정이력(Modification Information)]]
* 수정일                 수정자      수정내용
* ----------  ---------  -----------------
* 2022. 5. 2.      김재웅      최초작성
* Copyright (c) 2022 by DDIT All right reserved
 --%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib uri="http://www.springframework.org/security/tags"
	prefix="security"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>

<security:csrfMetaTags />
<security:authentication property="principal.realUser" var="authMember" />
<h5 class="fw-bold text-muted">장학금 신청</h5>
<hr>
<div class="col">
	<div class="p-3 border bg-light">
		<div class="panel-heading">
			<span class="enrTitle">장학금 리스트</span>
		</div>
		<table class="table table-hover text-center" id="enrTable">
			<colgroup>
				<col width="10%">
				<col width="10%">
				<col width="20%">
				<col width="10%">
				<col width="20%">
				<col width="10%">
			</colgroup>
			<thead>
				<tr>
					<th>장학금명</th>
					<th>성적기준</th>
					<th>신청자격</th>
					<th>장학금액</th>
					<th>장학금안내</th>
					<th>신청하기</th>
				</tr>
			</thead>
			<tbody>

				<c:forEach items="${schList}" var="schvo">
					<tr>
						<td>${schvo.schName }</td>
						<td>${schvo.schScore }</td>
						<td>${schvo.schQuali }</td>
						<td><fmt:formatNumber value="${schvo.schAmount}"
								pattern="#,###" />원</td>
						<td>${schvo.schContent}</td>
										<c:set var="doneLoop" value="true" />
						<c:forEach items="${aleardList }" var="aleard" >
							<c:if test="${aleard eq schvo.schNo}">
								<c:set var="flag" value="true" />
							</c:if>
						</c:forEach>
						<c:choose>
						
							<c:when test="${flag}">	
										<td><button type="button" class="btn btn-info"
												id="applyBtn" style="width: 100px;" name="${schvo.schNo }"
												disabled="disabled">신청하기</button></td>
							</c:when>
							<c:otherwise>
										<td><button type="button" class="btn btn-info"
												id="applyBtn" style="width: 100px;" name="${schvo.schNo }">신청하기</button></td>							
							</c:otherwise>
						</c:choose>
								<c:set var="flag" value="false" />
								
									
								
						
					</tr>
				</c:forEach>


			</tbody>
		</table>
	</div>
</div>


<script>
	$(function() {
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");

		$(document).on("click", "#applyBtn", function() {
			let schNo = $(this).attr("name");
			$.ajax({
				url : "${cPath}/applyScholar/studentScholarApply",
				data : {
					"schNo" : schNo
				},
				type : "post",
				beforeSend : function(xhr) {
					if (token && header) {
						xhr.setRequestHeader(header, token);
					}
				},
				success : function(resp) {
					if (resp == 1) {
						alert("신청완료");
					} else {
						alert("신청실패");
					}
					location.reload();

				},
				error : function(jqXHR, textStatus, errorThrown) {
					console.log(jqXHR);
					console.log(textStatus);
					console.log(errorThrown);
				}

			});
		});
	});
</script>